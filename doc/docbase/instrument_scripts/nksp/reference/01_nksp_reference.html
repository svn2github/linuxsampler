<html>
  <head>
    <meta name="author" content="Christian Schoenebeck">
    <title>NKSP Reference</title>
    <urlpath>Reference</urlpath>
    <navpath>Reference Manual</navpath>
    <meta name="description" content="Reference documentation of the NKSP real-time instrument script language.">
  </head>
  <body>
    <h1>NKSP Reference</h1>
    <p>
      This document gives you an overview of all built-in functions and built-in
      variables provided by the NKSP real-time instrument script language.
    </p>

    <h2>Built-In Functions</h2>
    <p>
      These are the built-in functions available with the NKSP realt-time
      instrument script language.
    </p>

    <h3>Core Language Functions</h3>
    <p>
      Most fundamental NKSP functions, independent from any purpose of being used in a sampler.
    </p>
    <table>
      <tr>
        <th>Function</th> <th>Description</th>
      </tr>
      <tr>
        <td><code lang="nksp">dec()</code></td>
        <td>Decrements the passed integer variable by one.</td>
      </tr>
      <tr>
        <td><code>inc()</code></td>
        <td>Increments the passed integer variable by one.</td>
      </tr>
      <tr>
        <td><code lang="nksp">message()</code></td>
        <td>Prints text to the sampler's terminal.</td>
      </tr>
      <tr>
        <td><code>exit()</code></td>
        <td>Stops execution of the current event handler instance.</td>
      </tr>
      <tr>
        <td><code>wait()</code></td>
        <td>Pauses execution for a certain amount of time.</td>
      </tr>
      <tr>
        <td><code>stop_wait()</code></td>
        <td>Resumes execution of a suspended script callback.</td>
      </tr>
      <tr>
        <td><code>abs()</code></td>
        <td>Calculates the absolute value of a given value.</td>
      </tr>
      <tr>
        <td><code>random()</code></td>
        <td>Random number generator.</td>
      </tr>
      <tr>
        <td><code>num_elements()</code></td>
        <td>Returns the size of the requested array variable.</td>
      </tr>
    </table>
    
    <h3>Common Sampler Functions</h3>
    <p>
      Basic sampler related functions, independent from a particular sampler
      format or sampler engine.
    </p>
    <table>
      <tr>
        <th>Function</th> <th>Description</th>
      </tr>
      <tr>
        <td><code>play_note()</code></td>
        <td>Triggers a new note.</td>
      </tr>
      <tr>
        <td><code>change_pan()</code></td>
        <td>Changes panning of voices (stereo balance).</td>
      </tr>
      <tr>
        <td><code>change_tune()</code></td>
        <td>Changes the tuning of voices.</td>
      </tr>
      <tr>
        <td><code>change_vol()</code></td>
        <td>Changes the volume of voices.</td>
      </tr>
      <tr>
        <td><code>change_cutoff()</code></td>
        <td>Changes filter cutoff frequency of voices.</td>
      </tr>
      <tr>
        <td><code>change_reso()</code></td>
        <td>Changes filter resonance of voices.</td>
      </tr>
      <tr>
        <td><code>event_status()</code></td>
        <td>Checks and returns whether a particular note is still alive.</td>
      </tr>
      <tr>
        <td><code>set_controller()</code></td>
        <td>Creates a MIDI control change event.</td>
      </tr>
      <tr>
        <td><code>ignore_event()</code></td>
        <td>Drops the given event.</td>
      </tr>
      <tr>
        <td><code>ignore_controller()</code></td>
        <td>Drops the given MIDI control change event.</td>
      </tr>
      <tr>
        <td><code>note_off()</code></td>
        <td>Releases the requested note.</td>
      </tr>
      <tr>
        <td><code>set_event_mark()</code></td>
        <td>Adds an event to an event group.</td>
      </tr>
      <tr>
        <td><code>delete_event_mark()</code></td>
        <td>Removes an event from some event group.</td>
      </tr>
      <tr>
        <td><code>by_marks()</code></td>
        <td>Returns all events of an event group.</td>
      </tr>
    </table>
    
    <h3>GigaStudio Format Functions</h3>
    <p>
      Sampler format specific functions, dedicated to the individual features
      of the GigaStudio format engine.
    </p>
    <table>
      <tr>
        <th>Function</th> <th>Description</th>
      </tr>
      <tr>
        <td><code>gig_set_dim_zone()</code></td>
        <td>Changes the currently active dimension zone.</td>
      </tr>
    </table>

    <h2>Built-In Variables</h2>
    <p>
      These are the built-in variables and built-in constants available with the
      NKSP realt-time instrument script language.
    </p>

    <h3>Core Language Variables</h3>
    <p>
      Most fundamental NKSP built-in variables, independent from any purpose of
      being used in a sampler.
    </p>
    <table>
      <tr>
        <th>Variable</th> <th>Description</th>
      </tr>
      <tr>
        <td><code>$KSP_TIMER</code></td>
        <td>Preserved for compatiblity reasons with KSP, returns the same value
           as <code>$NKSP_REAL_TIMER</code> (refer to the latter for details).
           Note that KSP's <code>reset_ksp_timer()</code> function is not available with
           NKSP. However when calculating time differences between two time
           stamps taken with <code>$NKSP_REAL_TIMER</code>, calling such a reset
           function is not required, because the underlying clock does not stop
           when it reached its value limit (which happens every 71 minutes), instead the clock
           will automatically restart from zero and the calculated time difference
           even between such transitions will reflect correct durations.</td>
      </tr>
      <tr>
        <td><code>$NKSP_PERF_TIMER</code></td>
        <td>Returns the current performance time stamp (in microseconds) of the
            script running. You may read this variable from time to time to take
            time stamps which can be used to calculate the time difference
            (in microseconds) which elapsed between them. A performance time
            stamp is based on the script's actual CPU execution time. So the
            internal clock which is used for generating such time stamps is only
            running forward if the respective script is actually executed by the
            CPU. Whenever your script is not really executed by the CPU (i.e. because
            your script got suspended by a wait() call or got forcely suspended due to
            real-time constraints, or when the entire sampler application got suspended
            by the OS for other applications or OS tasks) then the underlying internal
            clock is paused as well.
            <note class="important">
              You should only use this built-in variable for script development
              purposes (i.e. for bench marking the performance of your script).
              You should <b>not</b> use it with your final production sounds!
              It is not appropriate for being used in a musical context, because
              when an offline bounce is performed for instance, the musical timing
              will be completely unrelated to the CPU execution time. Plus using
              this variable may cause audio drop outs on some systems. In a musical
              context you should use <code>$ENGINE_UPTIME</code> instead, which is
              also safe for offline bounces.
            </note>
            <note>
              On some systems <code>$NKSP_REAL_TIMER</code> and
              <code>$NKSP_PERF_TIMER</code> will actually return the same value. So the
              difference between them is not implemented for all systems at the moment.
            </note>
        </td>
      </tr>
      <tr>
        <td><code>$NKSP_REAL_TIMER</code></td>
        <td>Returns the current time stamp in reality (in microseconds). You may
            read this variable from time to time to take
            time stamps which can be used to calculate the time difference
            (in microseconds) which elapsed between them. A "real" time
            stamp is based on an internal clock which constantly proceeds, so this
            internal clock also continues counting while your script is either suspended
            (i.e. because your script got suspended by a wait() call or got forcely
            suspended due to real-time constraints) and it also continues counting
            even if the entire sampler application got suspended by the OS (i.e. to
            execute other applications for multi-tasking or to perform OS tasks).
            <note class="important">
              You should only use this built-in variable for script development
              purposes (i.e. for bench marking the performance of your script).
              You should <b>not</b> use it with your final production sounds!
              It is not appropriate for being used in a musical context, because
              when an offline bounce is performed for instance, the musical timing
              will be completely unrelated to the CPU execution time. Plus using
              this variable may cause audio drop outs on some systems. In a musical
              context you should use <code>$ENGINE_UPTIME</code> instead, which is
              also safe for offline bounces.
            </note>
            <note>
              On some systems <code>$NKSP_REAL_TIMER</code> and
              <code>$NKSP_PERF_TIMER</code> will actually return the same value. So the
              difference between them is not implemented for all systems at the moment.
            </note>
        </td>
      </tr>
      <tr>
        <td><code>$NI_CALLBACK_ID</code></td>
        <td>Reflects the current event handler instance's unique callback ID.
            For the same event type there may be more than
            one event handler instances running. Each one of them has
            its own callback ID. You can get the current event handler
            instance's callback ID by reading this built-in variable.</td>
      </tr>
      <tr>
        <td><code>$NI_CALLBACK_TYPE</code></td>
        <td>Reflects the event type of the current event handler. This variable
            may reflect one of the following built-in constants:
            <code>$NI_CB_TYPE_INIT</code>, <code>$NI_CB_TYPE_NOTE</code>,
            <code>$NI_CB_TYPE_RELEASE</code>, <code>$NI_CB_TYPE_CONTROLLER</code>.</td>
      </tr>
      <tr>
        <td><code>$NI_CB_TYPE_INIT</code></td>
        <td>Built-in constant reflecting an <code>init</code> event handler type.</td>
      </tr>
      <tr>
        <td><code>$NI_CB_TYPE_NOTE</code></td>
        <td>Built-in constant reflecting a <code>note</code> event handler type.</td>
      </tr>
      <tr>
        <td><code>$NI_CB_TYPE_RELEASE</code></td>
        <td>Built-in constant reflecting a <code>release</code> event handler type.</td>
      </tr>
      <tr>
        <td><code>$NI_CB_TYPE_CONTROLLER</code></td>
        <td>Built-in constant reflecting a <code>controller</code> event handler type.</td>
      </tr>
      <tr>
        <td><code>$NKSP_IGNORE_WAIT</code></td>
        <td>If this boolean built-in variable is <code>1</code> then all calls of your
            event handler instance to function <code>wait()</code> will be ignored.
            This may for example be the case if another event handler instance
            resumed your paused script by calling <code>stop_wait()</code> and
            passing <code>1</code> to the 2nd argument of that function.</td>
      </tr>
    </table>

    <h3>Common Sampler Variables</h3>
    <p>
      Basic sampler related built-in variables and constants, independent from a
      particular sampler format or sampler engine.
    </p>
    <table>
      <tr>
        <th>Variable</th> <th>Description</th>
      </tr>
      <tr>
        <td><code>$CC_NUM</code></td>
        <td>MIDI controller number that caused the <code>controller</code>
            handler to be executed (only useful in the context of a
            <code>controller</code> handler).</td>
      </tr>
      <tr>
        <td><code>%CC[]</code></td>
        <td>Provides access to all current MIDI controller values. This can be
            used in any context. Use the respective MIDI controller number as
            index to this integer array variable. For instance <code>%CC[1]</code>
            would give you the current value of the modulation wheel.
            </td>
      </tr>
      <tr>
        <td><code>$EVENT_ID</code></td>
        <td>ID of the event that caused the current event handler to be executed. In
            the context of a <code>note</code> handler this would be the event
            ID of the note, within a <code>controller</code> handler it would
            be the controller event ID, etc.</td>
      </tr>
      <tr>
        <td><code>$EVENT_NOTE</code></td>
        <td>MIDI note number that caused a note related
            handler to be executed (only useful in the context of a
            <code>note</code> or <code>release</code> handler).</td>
      </tr>
      <tr>
        <td><code>$EVENT_VELOCITY</code></td>
        <td>MIDI velocity value of the note that caused that note related
            handler to be executed (only useful in the context of a
            <code>note</code> or <code>release</code> handler).</td>
      </tr>
      <tr>
        <td><code>$EVENT_STATUS_INACTIVE</code></td>
        <td>Constant bit flag used as possible return value by
            <code>event_status()</code> in case the requested
            note is not "alive".</td>
      </tr>
      <tr>
        <td><code>$EVENT_STATUS_NOTE_QUEUE</code></td>
        <td>Constant bit flag used as possible return value by
            <code>event_status()</code> in case the requested
            note is still "alive".</td>
      </tr>
      <tr>
        <td><code>%KEY_DOWN[]</code></td>
        <td>This can be used in any context to check whether a certain MIDI
            key is currently pressed down. Use the respective MIDI note number
            as index to this array variable (see also <code>event_status()</code>).</td>
      </tr>
      <tr>
        <td><code>$VCC_MONO_AT</code></td>
        <td>Constant identifying the MIDI monophonic aftertouch controller (also
            called <i title="Amount of force on held-down key.">
              MIDI channel pressure
            </i>). This is somewhat different than in the MIDI standard. With
            NKSP aftertouch is handled like an additional "regular" MIDI CC controller.
            Therefore use
            <code>%CC[$VCC_MONO_AT]</code> to obtain the current aftertouch value
            in the context of a <code>controller</code> event handler.
         </td>
      </tr>
      <tr>
        <td><code>$VCC_PITCH_BEND</code></td>
        <td>Constant identifying the pitch bend wheel controller.
            This is somewhat different than in the MIDI standard. With
            NKSP pitch bend is handled like an additional "regular" MIDI CC controller.
            Therefore use
            <code>%CC[$VCC_PITCH_BEND]</code> to obtain the current pitch bend wheel value
            in the context of a <code>controller</code> event handler.</td>
      </tr>
      <tr>
        <td><code>$MARK_1</code> to <code>$MARK_28</code></td>
        <td>Used to select one of the available 28 event groups.
        See <code>set_event_mark()</code> for details.</td>
      </tr>
      <tr>
        <td><code>$ENGINE_UPTIME</code></td>
        <td>Returns the current time stamp (in milliseconds) for being
            used in a musical context. You may read this variable from time to time
            to take time stamps which can be used to calculate the time difference
            (in milliseconds) which elapsed between them. These timing values are
            based on the internal sample rate and thus it can safely be used to
            perform musical timing related tasks in your scripts. Especially
            your script will also continue to behave correctly when an offline bounce
            of a song is performed.
        </td>
      </tr>
    </table>

    <h3>GigaStudio Format Variables</h3>
    <p>
      Sampler format specific built-in variables and constants, dedicated to the
      individual features of the GigaStudio format engine.
    </p>
    <table>
      <tr>
        <th>Variable</th> <th>Description</th>
      </tr>
      <tr>
        <td><code>$GIG_DIM_CHANNEL</code></td>
        <td>Constant that identifies the <i>stereo dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_LAYER</code></td>
        <td>Constant that identifies the <i>layer dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_VELOCITY</code></td>
        <td>Constant that identifies the <i>velocity dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_AFTERTOUCH</code></td>
        <td>Constant that identifies the <i>aftertouch dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_RELEASE</code></td>
        <td>Constant that identifies the <i>release trigger dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_KEYBOARD</code></td>
        <td>Constant that identifies the <i>keyboard position dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_ROUNDROBIN"</code></td>
        <td>Constant that identifies the <i>round robin dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_RANDOM</code></td>
        <td>Constant that identifies the <i>random dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_SMARTMIDI</code></td>
        <td>Constant that identifies the <i>start MIDI dimension</i> (a.k.a iMIDI rules).</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_ROUNDROBINKEY</code></td>
        <td>Constant that identifies the <i>round robin key dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_MODWHEEL</code></td>
        <td>Constant that identifies the <i>modulation wheel dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_SUSTAIN</code></td>
        <td>Constant that identifies the <i>sustain pedal dimension</i> (a.k.a. hold pedal).</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_PORTAMENTO</code></td>
        <td>Constant that identifies the <i>portamento MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_SOSTENUTO</code></td>
        <td>Constant that identifies the <i>sostenuto MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_SOFT</code></td>
        <td>Constant that identifies the <i>soft pedal dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_BREATH</code></td>
        <td>Constant that identifies the <i>breath controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_FOOT</code></td>
        <td>Constant that identifies the <i>foot pedal dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_PORTAMENTOTIME</code></td>
        <td>Constant that identifies the <i>portamento time controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_EFFECT1</code></td>
        <td>Constant that identifies the <i>effect 1 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_EFFECT2</code></td>
        <td>Constant that identifies the <i>effect 2 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_EFFECT1DEPTH</code></td>
        <td>Constant that identifies the <i>effect 1 depth MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_EFFECT2DEPTH</code></td>
        <td>Constant that identifies the <i>effect 2 depth MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_EFFECT3DEPTH</code></td>
        <td>Constant that identifies the <i>effect 3 depth MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_EFFECT4DEPTH</code></td>
        <td>Constant that identifies the <i>effect 4 depth MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_EFFECT5DEPTH</code></td>
        <td>Constant that identifies the <i>effect 5 depth MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_GENPURPOSE1</code></td>
        <td>Constant that identifies the <i>general purpose 1 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_GENPURPOSE2</code></td>
        <td>Constant that identifies the <i>general purpose 2 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_GENPURPOSE3</code></td>
        <td>Constant that identifies the <i>general purpose 3 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_GENPURPOSE4</code></td>
        <td>Constant that identifies the <i>general purpose 4 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_GENPURPOSE5</code></td>
        <td>Constant that identifies the <i>general purpose 5 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_GENPURPOSE6</code></td>
        <td>Constant that identifies the <i>general purpose 6 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_GENPURPOSE7</code></td>
        <td>Constant that identifies the <i>general purpose 7 MIDI controller dimension</i>.</td>
      </tr>
      <tr>
        <td><code>$GIG_DIM_GENPURPOSE8</code></td>
        <td>Constant that identifies the <i>general purpose 8 MIDI controller dimension</i>.</td>
      </tr>
    </table>
    
  </body>
</html>
